# ==================================================================
# SYNOPSYS CONFIDENTIAL - This is an unpublished, proprietary work  
# of Synopsys, Inc., and is fully protected under copyright and     
# trade secret laws. You may not view, use, disclose, copy, or      
# distribute this file or any information contained herein except   
# pursuant to a valid written license from Synopsys.                
# ==================================================================

"""
.. currentmodule:: swbutils.common.TclStartup

Utility class for generating a tcl test script.
"""

import os
import weakref

from swbutils.common.Utils import _get_fullpath

class TclStartup:
    def __init__(self, id, path = None):
        self.script, self.temp = self._create_files(id, path)
        weakref.finalize(self, self.finalize)

    def finalize(self):
        self._remove_file(self.script)
        self._remove_file(self.temp)

    def _create_files(self, id, path):
        scriptname = _get_fullpath(path, 'startup_' + id + '.tcl')
        self._remove_file(scriptname)
        tempfilename = _get_fullpath(path, '.' + id)
        self._remove_file(tempfilename)
        script = open(scriptname, 'w+')
        script_body = 'set touch [open "' + tempfilename + '" w+] ; close $touch'
        script.write(script_body)
        script.close()
        return scriptname, tempfilename
    
    def _remove_file(self, filename):
        if os.access(filename, os.W_OK):
            os.remove(filename)
                
    def is_tcl_ready(self):
        return os.access(self.temp, os.R_OK)
    def get_script(self):
        return self.script

